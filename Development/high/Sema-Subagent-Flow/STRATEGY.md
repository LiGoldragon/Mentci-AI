# Strategy: Sema-Subagent-Flow

## 1. Goal
Implement a deterministic, actor-based subagent flow using the `@oh-my-pi/subagents` extension that strictly adheres to the Sema architectural guidelines and the philosophical intent of Li Goldragon. Specifically, deprecate Attractor in favor of an EDN/Aski-based subagent orchestration where agents converse natively in `lojix`.

## 2. Architecture: The Russian Doll Sub-Flow Model
The `pi` agent acts as the Master Process (Mentci-Aid). To execute complex tasks (Directed Acyclic Graphs), it orchestrates specialized subagents in a fractal hierarchy:
1.  **State Separation & Isolation:** Subagents do not operate on the parent's Jujutsu bookmark. Sequential subagents can share a process owner, but parallel subagents *must* be fully owned by a distinct sub-process (a "sub mentci-box") acting on its own Jujutsu branch (e.g., `jj new -b subagent-task-A`).
2.  **Actor-Based Programming (Single Ownership):** Each task, file, or object has a single owner. This prevents double-ownership data races.
3.  **Aski & Lojix Communication:** Agents converse natively in Aski (extremely concise code in ascii characters, inspired by Shen, Clojure, and Carp) rather than natural language. Lojix (an Aski dialect based on EDN) acts as the data-serialization language between subagents to maximize context token efficiency.
4.  **Init Envelope Purity:** Configuration state must be passed via Cap'n Proto (`capnp`) objects or structured EDN/Lojix sidecars.
5.  **Attractor Obsolescence:** The external Node.js/TypeScript Attractor engine is obsolete. It lacks support for native Jujutsu branching and Nix jail isolation required by the Russian Doll Model. We will use native EDN-based orchestration in Rust and compile to DOT graphs purely for visualization, not execution.

## 3. The Implementation Pipeline
The `pi` prompt template located at `.pi/prompts/sema-flow.md` implements the following subagent orchestration protocol:

### Phase 1: The Architect (`@planner`)
Generates a structured `lojix` (EDN Next) DAG representing the task checklist and Cap'n Proto boundary boundaries. (Bypasses the DOT graph Attractor handoff).

### Phase 2: The Sidereal Eye (`@explore`)
Scans the `Sources/` and `Components/` directories for existing Cap'n Proto schemas and Rust actors. Emits a `lojix` summary of required filesystem paths to be modified.

### Phase 3: The Warrior (`@task`)
Executes the code modifications. Enforces **State Separation** by spinning up a sub mentci-box and committing changes to a unique, internal Jujutsu bookmark for its isolated sub-flow.

### Phase 4: The Pure Truth (`@reviewer`)
Evaluates the subagent's `jj` diff. Checks for "Init Envelope Purity" (no env variables for domain config) and strict capitalisation ontology before squashing the sub-branch into the parent flow.

## 4. Observability and Data-Stream
The telemetry generated by the subagents (previously known as `PipelineEvents` in Attractor) will be exposed as a **Sub-flow Trace** (or Observability Stream). This data stream allows human users or other monitoring agents to consume the live task execution events in real time.

## 5. Unresolved Questions & Suggestions
*See the corresponding `Research/high/Sema-Subagent-Flow/*` documents for deeper philosophical mapping of EDN, Aski, Shen/Clojure inspiration, and Jujutsu CLI wrapper suggestions for the author.*